#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<ctype.h>

char prod[10][10],res[10];
int nmp,m=0,visited_follow[26]={0};
void result(char ch);
void FOLLOW(char c);
void FIND_FIRST(char c);
void FIRST(char c);

void FIND_FIRST(char c)
{
    if(!(isupper(c)))
    {
        result(c);
        return;
    }
    for(int i=0;i<nmp;i++)
    {
        if(prod[i][0]==c)
        {
            if(prod[i][2]=='#')
            {
                result('#');
            }
            if(islower(prod[i][2]))
            {
                result(prod[i][2]);
            }
            if(isupper(prod[i][2]))
            {
                FIND_FIRST(prod[i][2]);
            }
        }
    }
}

void FOLLOW(char c)
{
    if(visited_follow[c-'A']) return;
    visited_follow[c-'A']=1;

    if (prod[0][0] == c)
        result('$');

    for(int i=0;i<nmp;i++)
    {
        int len=strlen(prod[i]);
        for(int j=2;j<len;j++)
        {
            if(prod[i][j]==c)
            {
                if(j+1<len)
                {
                    if(isupper(prod[i][j+1]))
                    {
                        FIRST(prod[i][j+1]);
                    }
                    else if(islower(prod[i][j+1]))
                    {
                        result(prod[i][j+1]);
                    }
                    
                }
                else if(j+1==len||prod[i][j+1]=='#')
                {
                    if(prod[i][0]!=c)
                    {
                        FOLLOW(prod[i][0]);
                    }
                }
            }
        }
    }
}
void FIRST(char c)
{
    if(!(isupper(c)))
    {
        result(c);
    }
    for(int i=0;i<nmp;i++)
    {
        if(prod[i][0]==c)
        {
             
            if(islower(prod[i][2]))
            {
                result(prod[i][2]);
            }
            if(isupper(prod[i][2]))
            {
                FIRST(prod[i][2]);
            }
            if (prod[i][2] == '#')
            {
                FOLLOW(prod[i][0]);
            }
           
        }
    }
    return ;
}
void result(char c)
{
    for(int i=0;i<=m;i++)
    {
        if(res[i]==c)
        {
            return;
        }
    }
    res[m++]=c;
}

int main()
{
    int choice,option;
    char c;
    printf("Enter the no of productions:");
    scanf("%d",&nmp);

    printf("Enter the productions (E=E+E):\n");
    for(int i=0;i<nmp;i++)
    {
        printf("Enter the prod %d:",i);
        scanf("%s",prod[i]);
    }

    do
    {
        printf("\nWhat do you wnat to do?\n1.Find First\n2.Find Follow\n");
        scanf("%d",&option);

        printf("Enter the symbol:");
        scanf(" %c",&c);

        m=0;
        memset(res,0,sizeof(res));

        if(option==1)
        {
            FIND_FIRST(c);
            printf("First:{ ");
            for(int j=0;j<strlen(res);j++)
            {
                printf("%c ",res[j]);
            }
            printf("}");
        }
        else if(option==2)
        {
            memset(visited_follow,0,sizeof(visited_follow));
            FOLLOW(c);
            printf("Follow:{ ");
            for(int j=0;j<strlen(res);j++)
            {
                printf("%c ",res[j]);
            }
            printf("}");
        }
        else
        {
            printf("Invalid\n");
        }
        printf("do you wnat to continue(0/1):");
        scanf("%d",&choice);
    }while(choice==1);
}
